<app-header></app-header>

<ion-content [fullscreen]="true">
  <div class="search-bar-container">
    <ion-searchbar
      placeholder="Search"
      [value]="searchQuery"
      (ionInput)="onSearchChange($event)"
      showCancelButton="focus"
    ></ion-searchbar>
  </div>

  @if (error) {
    <div class="error-message">
      {{ error }}
    </div>
  }

  <div class="results-container">
    <h2>
      @if (categoryName) {
        Serviços em {{ categoryName }}
      } @else if (searchQuery) {
        Resultados para "{{ searchQuery }}"
      } @else {
        Todos os Serviços
      }
    </h2>
    
    @if (isLoading) {
      <div class="loading-container">
        <ion-spinner></ion-spinner>
        <p>Loading services...</p>
      </div>
    } @else if (filteredServices.length > 0) {
      @for (service of filteredServices; track service.id) {
        <div class="service-card" (click)="goToProfile(service)">
          <div class="service-avatar">
            <ion-icon name="person-circle-outline" size="large"></ion-icon>
          </div>
          <div class="service-info">
            <div class="service-title">{{ service.name }}</div>
            <div class="service-desc">{{ service.description }}</div>
            <div class="service-details">
              <div class="service-rating">
                <span class="stars">
                  @for (star of getStars(service.rating); track $index) {
                    <ion-icon [name]="star ? 'star' : 'star-outline'"></ion-icon>
                  }
                </span>
                <span class="rating">{{ service.rating.toFixed(1) }}</span>
              </div>
              <div class="service-price">{{ service.price }}</div>
            </div>
            <div class="service-provider">{{ service.provider }}</div>
          </div>
        </div>
      }
    } @else {
      <div class="no-results">
        <p>No services found matching your criteria.</p>
      </div>
    }
  </div>

  <ion-button 
    expand="block" 
    class="call-btn" 
    (click)="onCall(filteredServices[0])" 
    [disabled]="filteredServices.length === 0 || isLoading">
    CALL
  </ion-button>
</ion-content>
